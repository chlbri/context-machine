{"version":3,"file":"context-machine.cjs.development.js","sources":["../src/createContextMachine.ts","../src/hooks.ts","../src/Provider.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\r\nimport { UseMachineOptions } from '@xstate/react/lib/types';\r\nimport { createContext } from 'react';\r\nimport {\r\n  createMachine,\r\n  EventObject,\r\n  interpret,\r\n  InterpreterOptions,\r\n  MachineConfig,\r\n  MachineOptions, Typestate\r\n} from 'xstate';\r\nimport { Model } from 'xstate/lib/model.types';\r\n\r\nexport function createContextMachine<\r\n  TC,\r\n  TE extends EventObject,\r\n  TT extends Typestate<TC> = {\r\n    value: any;\r\n    context: TC;\r\n  }\r\n>(\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  config: TC extends Model<any, any, any> ? never : MachineConfig<TC, any, TE>,\r\n  options?: Partial<InterpreterOptions> &\r\n    Partial<UseMachineOptions<TC, TE>> &\r\n    Partial<MachineOptions<TC, TE>>\r\n) {\r\n  const machine = createMachine<TC, TE, TT>(config, options);\r\n  const service = interpret(machine);\r\n  return createContext(service);\r\n}\r\n","/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\r\nimport {\r\n  useActor,\r\n  useInterpret,\r\n  useSelector as useSelectorR,\r\n} from '@xstate/react';\r\nimport { MaybeLazy, UseMachineOptions } from '@xstate/react/lib/types';\r\nimport { useContext as useContextR } from 'react';\r\nimport {\r\n  EventObject,\r\n  InterpreterOptions,\r\n  MachineOptions,\r\n  StateMachine,\r\n  Typestate,\r\n} from 'xstate';\r\nimport { ContextMachineType, MachineType, Selector } from './types';\r\n\r\nexport function usePrepare<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  }\r\n>(\r\n  machine: MaybeLazy<StateMachine<TContext, any, TEvent, TTypestate>>,\r\n  options?: Partial<InterpreterOptions> &\r\n    Partial<UseMachineOptions<TContext, TEvent>> &\r\n    Partial<MachineOptions<TContext, TEvent>>\r\n) {\r\n  return useInterpret(machine, options);\r\n}\r\n\r\nexport function useState<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  }\r\n>(\r\n  Context: ContextMachineType<TContext, TEvent, TTypestate>\r\n): MachineType<TContext, TEvent, TTypestate>['state'] {\r\n  const service = useContextR(Context);\r\n\r\n  const [state] = useActor(service);\r\n  return state;\r\n}\r\n\r\nexport function useSelector<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  },\r\n  R = any\r\n>(\r\n  Context: ContextMachineType<TContext, TEvent, TTypestate>,\r\n  selector: Selector<TContext, TEvent, TTypestate, R>\r\n): R {\r\n  const service = useContextR(Context);\r\n\r\n  const _out = useSelectorR(service, selector);\r\n  return _out;\r\n}\r\n\r\nexport function useSend<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  }\r\n>(\r\n  Context: ContextMachineType<TContext, TEvent, TTypestate>\r\n): MachineType<TContext, TEvent, TTypestate>['send'] {\r\n  const service = useContextR(Context);\r\n\r\n  return service.send;\r\n}\r\n\r\nexport function useCustomService<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  }\r\n>(\r\n  Context: ContextMachineType<TContext, TEvent, TTypestate>\r\n): MachineType<TContext, TEvent, TTypestate>['custom_service'] {\r\n  const {\r\n    getSnapshot,\r\n    id,\r\n    initialState,\r\n    off,\r\n    onChange,\r\n    onDone,\r\n    onEvent,\r\n    onSend,\r\n    onStop,\r\n    status,\r\n    stop,\r\n    subscribe,\r\n    sessionId,\r\n    toJSON,\r\n  } = useContextR(Context);\r\n\r\n  return {\r\n    getSnapshot,\r\n    id,\r\n    initialState,\r\n    off,\r\n    onChange,\r\n    onDone,\r\n    onEvent,\r\n    onSend,\r\n    onStop,\r\n    status,\r\n    stop,\r\n    subscribe,\r\n    sessionId,\r\n    toJSON,\r\n  };\r\n}\r\n\r\nexport function useContext<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  }\r\n>(\r\n  Context: ContextMachineType<TContext, TEvent, TTypestate>\r\n): MachineType<TContext, TEvent, TTypestate> {\r\n  const out = {\r\n    state: useState(Context),\r\n    send: useSend(Context),\r\n    custom_service: useCustomService(Context),\r\n  };\r\n\r\n  return out;\r\n}\r\n","import { UseMachineOptions } from '@xstate/react/lib/types';\r\nimport React, { PropsWithChildren, useContext } from 'react';\r\nimport {\r\n  EventObject,\r\n  InterpreterOptions,\r\n  MachineOptions,\r\n  Typestate,\r\n} from 'xstate';\r\nimport { usePrepare } from './hooks';\r\nimport { ContextMachineType } from './types';\r\n\r\ntype Props<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  }\r\n> = {\r\n  Context: ContextMachineType<TContext, TEvent, TTypestate>;\r\n  options?: Partial<InterpreterOptions> &\r\n    Partial<UseMachineOptions<TContext, TEvent>> &\r\n    Partial<MachineOptions<TContext, TEvent>>;\r\n};\r\n\r\nexport function MachineProvider<\r\n  TContext,\r\n  TEvent extends EventObject,\r\n  TTypestate extends Typestate<TContext> = {\r\n    value: any;\r\n    context: TContext;\r\n  }\r\n>({\r\n  Context,\r\n  children,\r\n  options,\r\n}: PropsWithChildren<Props<TContext, TEvent, TTypestate>>): JSX.Element {\r\n  const service = useContext(Context);\r\n  const value = usePrepare(service.machine, options);\r\n\r\n  return <Context.Provider {...{ value }}>{children}</Context.Provider>;\r\n}\r\n"],"names":["createContextMachine","config","options","machine","createMachine","service","interpret","createContext","usePrepare","useInterpret","useState","Context","useContextR","useActor","state","useSelector","selector","_out","useSelectorR","useSend","send","useCustomService","getSnapshot","id","initialState","off","onChange","onDone","onEvent","onSend","onStop","status","stop","subscribe","sessionId","toJSON","useContext","out","custom_service","MachineProvider","children","value","React","Provider"],"mappings":";;;;;;;;;;;SAagBA;AASdC,QACAC;AAIA,MAAMC,OAAO,GAAGC,oBAAa,CAAaH,MAAb,EAAqBC,OAArB,CAA7B;AACA,MAAMG,OAAO,GAAGC,gBAAS,CAACH,OAAD,CAAzB;AACA,SAAOI,mBAAa,CAACF,OAAD,CAApB;AACD;;AC9BD;AACA,SAgBgBG,WAQdL,SACAD;AAIA,SAAOO,kBAAY,CAACN,OAAD,EAAUD,OAAV,CAAnB;AACD;AAED,SAAgBQ,SAQdC;AAEA,MAAMN,OAAO,GAAGO,gBAAW,CAACD,OAAD,CAA3B;;AAEA,kBAAgBE,cAAQ,CAACR,OAAD,CAAxB;AAAA,MAAOS,KAAP;;AACA,SAAOA,KAAP;AACD;AAED,SAAgBC,YASdJ,SACAK;AAEA,MAAMX,OAAO,GAAGO,gBAAW,CAACD,OAAD,CAA3B;;AAEA,MAAMM,IAAI,GAAGC,iBAAY,CAACb,OAAD,EAAUW,QAAV,CAAzB;;AACA,SAAOC,IAAP;AACD;AAED,SAAgBE,QAQdR;AAEA,MAAMN,OAAO,GAAGO,gBAAW,CAACD,OAAD,CAA3B;AAEA,SAAON,OAAO,CAACe,IAAf;AACD;AAED,SAAgBC,iBAQdV;AAEA,qBAeIC,gBAAW,CAACD,OAAD,CAff;AAAA,MACEW,WADF,gBACEA,WADF;AAAA,MAEEC,EAFF,gBAEEA,EAFF;AAAA,MAGEC,YAHF,gBAGEA,YAHF;AAAA,MAIEC,GAJF,gBAIEA,GAJF;AAAA,MAKEC,QALF,gBAKEA,QALF;AAAA,MAMEC,MANF,gBAMEA,MANF;AAAA,MAOEC,OAPF,gBAOEA,OAPF;AAAA,MAQEC,MARF,gBAQEA,MARF;AAAA,MASEC,MATF,gBASEA,MATF;AAAA,MAUEC,MAVF,gBAUEA,MAVF;AAAA,MAWEC,IAXF,gBAWEA,IAXF;AAAA,MAYEC,SAZF,gBAYEA,SAZF;AAAA,MAaEC,SAbF,gBAaEA,SAbF;AAAA,MAcEC,MAdF,gBAcEA,MAdF;;AAiBA,SAAO;AACLb,IAAAA,WAAW,EAAXA,WADK;AAELC,IAAAA,EAAE,EAAFA,EAFK;AAGLC,IAAAA,YAAY,EAAZA,YAHK;AAILC,IAAAA,GAAG,EAAHA,GAJK;AAKLC,IAAAA,QAAQ,EAARA,QALK;AAMLC,IAAAA,MAAM,EAANA,MANK;AAOLC,IAAAA,OAAO,EAAPA,OAPK;AAQLC,IAAAA,MAAM,EAANA,MARK;AASLC,IAAAA,MAAM,EAANA,MATK;AAULC,IAAAA,MAAM,EAANA,MAVK;AAWLC,IAAAA,IAAI,EAAJA,IAXK;AAYLC,IAAAA,SAAS,EAATA,SAZK;AAaLC,IAAAA,SAAS,EAATA,SAbK;AAcLC,IAAAA,MAAM,EAANA;AAdK,GAAP;AAgBD;AAED,SAAgBC,WAQdzB;AAEA,MAAM0B,GAAG,GAAG;AACVvB,IAAAA,KAAK,EAAEJ,QAAQ,CAACC,OAAD,CADL;AAEVS,IAAAA,IAAI,EAAED,OAAO,CAACR,OAAD,CAFH;AAGV2B,IAAAA,cAAc,EAAEjB,gBAAgB,CAACV,OAAD;AAHtB,GAAZ;AAMA,SAAO0B,GAAP;AACD;;SCvHeE;MAQd5B,eAAAA;MACA6B,gBAAAA;MACAtC,eAAAA;AAEA,MAAMG,OAAO,GAAG+B,gBAAU,CAACzB,OAAD,CAA1B;AACA,MAAM8B,KAAK,GAAGjC,UAAU,CAACH,OAAO,CAACF,OAAT,EAAkBD,OAAlB,CAAxB;AAEA,SAAOwC,4BAAA,CAAC/B,OAAO,CAACgC,QAAT,oBAAsB;AAAEF,IAAAA,KAAK,EAALA;AAAF,IAAtB,EAAkCD,QAAlC,CAAP;AACD;;;;;;;;;;;"}